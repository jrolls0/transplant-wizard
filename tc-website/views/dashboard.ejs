<%- include('partials/header', {title: 'Dashboard'}) %>

<!-- Dashboard Hero Section -->
<section class="dashboard-hero bg-light">
    <div class="container py-4">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <div class="hero-content">
                    <h1 class="display-6 fw-bold mb-2">Welcome, Dr. <%= user.first_name %> <%= user.last_name %></h1>
                    <p class="lead text-muted mb-0">
                        <i class="fas fa-hospital me-2 text-primary"></i>
                        <%= user.center_name %> • <%= user.city %>, <%= user.state %>
                    </p>
                    <p class="text-muted mt-1">
                        <small><%= user.role.charAt(0).toUpperCase() + user.role.slice(1).replace('_', ' ') %> • <%= user.department %></small>
                    </p>
                </div>
            </div>
            <div class="col-lg-4 text-lg-end">
                <span class="badge bg-white bg-opacity-90 text-dark px-3 py-2 rounded-pill fs-6">
                    <i class="fas fa-calendar me-2"></i>
                    <%= new Date().toLocaleDateString('en-US', { 
                        weekday: 'long', 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric' 
                    }) %>
                </span>
            </div>
        </div>
    </div>
</section>

<!-- Statistics Section -->
<section class="dashboard-stats py-4">
    <div class="container">
        <div class="row g-4">
            <div class="col-xl-3 col-md-6">
                <div class="modern-stat-card h-100">
                    <div class="card-body p-4">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <div class="stat-icon text-primary mb-3">
                                    <i class="fas fa-users"></i>
                                </div>
                                <h3 class="h4 fw-bold mb-2">Total Active Patients</h3>
                                <p class="text-muted mb-0">Excluding Declined</p>
                            </div>
                            <div class="text-end">
                                <h2 class="display-4 fw-bold text-primary mb-0"><%= stats.totalActive %></h2>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-xl-3 col-md-6">
                <div class="modern-stat-card h-100">
                    <div class="card-body p-4">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <div class="stat-icon text-warning mb-3">
                                    <i class="fas fa-user-plus"></i>
                                </div>
                                <h3 class="h4 fw-bold mb-2">New Referrals</h3>
                                <p class="text-muted mb-0">Awaiting Review</p>
                            </div>
                            <div class="text-end">
                                <h2 class="display-4 fw-bold text-warning mb-0"><%= stats.newReferrals %></h2>
                                <a href="/referrals" class="badge bg-warning bg-opacity-10 text-warning px-2 py-1 rounded-pill text-decoration-none">
                                    View All <i class="fas fa-arrow-right ms-1"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-xl-3 col-md-6">
                <div class="modern-stat-card h-100">
                    <div class="card-body p-4">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <div class="stat-icon text-info mb-3">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <h3 class="h4 fw-bold mb-2">Avg. Review Time</h3>
                                <p class="text-muted mb-0">Days to Process</p>
                            </div>
                            <div class="text-end">
                                <h2 class="display-4 fw-bold text-info mb-0"><%= stats.avgReviewDays %></h2>
                                <span class="text-muted small">days</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
        
        <!-- Status Breakdown Row -->
        <div class="row g-4 mt-2">
            <div class="col-12">
                <div class="modern-stat-card">
                    <div class="card-body p-4">
                        <h5 class="fw-bold mb-3"><i class="fas fa-chart-pie me-2"></i>Patients by Status</h5>
                        <div class="row text-center">
                            <div class="col">
                                <div class="p-3 rounded" style="background: rgba(251, 191, 36, 0.1);">
                                    <h3 class="fw-bold text-warning mb-1"><%= stats.newReferrals %></h3>
                                    <small class="text-muted">Applied</small>
                                </div>
                            </div>
                            <div class="col">
                                <div class="p-3 rounded" style="background: rgba(59, 130, 246, 0.1);">
                                    <h3 class="fw-bold text-primary mb-1"><%= stats.underReview %></h3>
                                    <small class="text-muted">Under Review</small>
                                </div>
                            </div>
                            <div class="col">
                                <div class="p-3 rounded" style="background: rgba(16, 185, 129, 0.1);">
                                    <h3 class="fw-bold text-success mb-1"><%= stats.accepted %></h3>
                                    <small class="text-muted">Accepted</small>
                                </div>
                            </div>
                            <div class="col">
                                <div class="p-3 rounded" style="background: rgba(139, 92, 246, 0.1);">
                                    <h3 class="fw-bold" style="color: #8b5cf6;"><%= stats.waitlisted %></h3>
                                    <small class="text-muted">Waitlisted</small>
                                </div>
                            </div>
                            <div class="col">
                                <div class="p-3 rounded" style="background: rgba(239, 68, 68, 0.1);">
                                    <h3 class="fw-bold text-danger mb-1"><%= stats.declined %></h3>
                                    <small class="text-muted">Declined</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Quick Actions & Recent Activity -->
<section class="dashboard-content py-5">
    <div class="container">
        <div class="row g-4">
            <!-- Quick Actions -->
            <div class="col-lg-4">
                <div class="modern-card h-100">
                    <div class="card-header border-0 bg-transparent">
                        <h5 class="card-title mb-0 fw-bold">Quick Actions</h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-3">
                            <a href="/referrals/new" class="action-link text-decoration-none">
                                <div class="action-item p-3 rounded">
                                    <div class="d-flex align-items-center">
                                        <div class="action-icon text-primary me-3">
                                            <i class="fas fa-plus-circle"></i>
                                        </div>
                                        <div>
                                            <h6 class="fw-bold mb-1">Review New Referral</h6>
                                            <small class="text-muted">Process incoming patient referrals</small>
                                        </div>
                                    </div>
                                </div>
                            </a>
                            
                            <a href="/patients/search" class="action-link text-decoration-none">
                                <div class="action-item p-3 rounded">
                                    <div class="d-flex align-items-center">
                                        <div class="action-icon text-success me-3">
                                            <i class="fas fa-search"></i>
                                        </div>
                                        <div>
                                            <h6 class="fw-bold mb-1">Search Patients</h6>
                                            <small class="text-muted">Find patient records and history</small>
                                        </div>
                                    </div>
                                </div>
                            </a>
                            
                            <a href="/appointments/schedule" class="action-link text-decoration-none">
                                <div class="action-item p-3 rounded">
                                    <div class="d-flex align-items-center">
                                        <div class="action-icon text-warning me-3">
                                            <i class="fas fa-calendar-plus"></i>
                                        </div>
                                        <div>
                                            <h6 class="fw-bold mb-1">Schedule Appointment</h6>
                                            <small class="text-muted">Book evaluation appointments</small>
                                        </div>
                                    </div>
                                </div>
                            </a>
                            
                            <a href="/reports" class="action-link text-decoration-none">
                                <div class="action-item p-3 rounded">
                                    <div class="d-flex align-items-center">
                                        <div class="action-icon text-info me-3">
                                            <i class="fas fa-chart-bar"></i>
                                        </div>
                                        <div>
                                            <h6 class="fw-bold mb-1">Generate Reports</h6>
                                            <small class="text-muted">Performance analytics and metrics</small>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Recent Activity -->
            <div class="col-lg-8">
                <div class="modern-card h-100">
                    <div class="card-header border-0 bg-transparent d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0 fw-bold">Recent Referrals</h5>
                        <a href="/referrals" class="btn btn-sm btn-outline-primary">View All</a>
                    </div>
                    <div class="card-body">
                        <div class="activity-list">
                            <% if (referrals && referrals.length > 0) { %>
                                <% referrals.forEach((referral, index) => { %>
                                    <div class="activity-item <%= index < referrals.length - 1 ? 'mb-4 pb-3 border-bottom' : '' %>">
                                        <div class="d-flex justify-content-between align-items-start">
                                            <div class="d-flex">
                                                <div class="activity-avatar me-3">
                                                    <div class="avatar-circle bg-primary text-white">
                                                        <%= referral.first_name ? referral.first_name.charAt(0) : '' %><%= referral.last_name ? referral.last_name.charAt(0) : '' %>
                                                    </div>
                                                </div>
                                                <div class="activity-content">
                                                    <h6 class="fw-bold mb-1"><%= referral.first_name %> <%= referral.last_name %></h6>
                                                    <p class="text-muted mb-2">
                                                        <% if (referral.dialysis_clinic) { %>
                                                            Referral from <%= referral.dialysis_clinic %>
                                                            <% if (referral.sw_first_name) { %> via <%= referral.sw_first_name %> <%= referral.sw_last_name %><% } %>
                                                        <% } else { %>
                                                            Patient referral received
                                                        <% } %>
                                                    </p>
                                                    <div class="d-flex align-items-center gap-3 flex-wrap">
                                                        <small class="text-muted">
                                                            <i class="fas fa-clock me-1"></i>
                                                            <%= new Date(referral.submitted_at).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) %>
                                                        </small>
                                                        <span class="badge 
                                                            <% if (referral.status === 'submitted') { %>bg-warning bg-opacity-10 text-warning<% } %>
                                                            <% if (referral.status === 'acknowledged') { %>bg-info bg-opacity-10 text-info<% } %>
                                                            <% if (referral.status === 'completed') { %>bg-success bg-opacity-10 text-success<% } %>
                                                            <% if (referral.status === 'pending') { %>bg-secondary bg-opacity-10 text-secondary<% } %>
                                                        ">
                                                            <%= referral.status.charAt(0).toUpperCase() + referral.status.slice(1) %>
                                                        </span>
                                                        <% if (referral.document_count > 0) { %>
                                                            <span class="badge bg-primary bg-opacity-10 text-primary">
                                                                <i class="fas fa-file-alt me-1"></i><%= referral.document_count %> doc<%= referral.document_count > 1 ? 's' : '' %>
                                                            </span>
                                                        <% } %>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="d-flex gap-2">
                                                <% if (referral.document_count > 0) { %>
                                                    <a href="/patient/<%= referral.patient_id %>/documents" class="btn btn-sm btn-outline-info" title="View Documents">
                                                        <i class="fas fa-folder-open"></i>
                                                    </a>
                                                <% } %>
                                                <a href="/patient/<%= referral.patient_id %>" class="btn btn-sm btn-outline-primary">Review</a>
                                            </div>
                                        </div>
                                    </div>
                                <% }); %>
                            <% } else { %>
                                <div class="text-center py-5">
                                    <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                                    <p class="text-muted">No referrals yet. Patient referrals will appear here.</p>
                                </div>
                            <% } %>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
/* Dashboard Specific Styles */
.dashboard-hero {
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
    border-bottom: 1px solid var(--border-color);
}

.modern-stat-card {
    background: white;
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-sm);
    border: none;
    transition: all 0.3s ease;
}

.modern-stat-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

.stat-icon {
    font-size: 1.5rem;
    width: 60px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(var(--bs-primary-rgb), 0.1);
    border-radius: var(--radius-md);
}

.modern-card {
    background: white;
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-sm);
    border: none;
    transition: all 0.3s ease;
}

.action-item {
    background: rgba(248, 250, 252, 0.7);
    border: 1px solid transparent;
    transition: all 0.3s ease;
}

.action-item:hover {
    background: rgba(5, 150, 105, 0.05);
    border-color: rgba(5, 150, 105, 0.1);
    transform: translateX(4px);
}

.action-icon {
    font-size: 1.25rem;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(var(--bs-primary-rgb), 0.1);
    border-radius: var(--radius-md);
}

.activity-avatar .avatar-circle {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 0.9rem;
}

.activity-item {
    transition: all 0.3s ease;
}

.activity-item:hover {
    background: rgba(248, 250, 252, 0.5);
    padding: 1rem !important;
    margin: 0 -1rem;
    border-radius: var(--radius-md);
}

/* Color scheme adjustments for transplant center branding */
.text-primary { color: #059669 !important; }
.bg-primary { background-color: #059669 !important; }
.border-primary { border-color: #059669 !important; }
.btn-primary { 
    background-color: #059669; 
    border-color: #059669; 
}
.btn-outline-primary { 
    color: #059669; 
    border-color: #059669; 
}
.btn-outline-primary:hover { 
    background-color: #059669; 
    border-color: #059669; 
}

/* Badge color overrides */
.badge.bg-primary { background-color: #059669 !important; }
.badge.text-primary { color: #059669 !important; }
.bg-primary.bg-opacity-10 { background-color: rgba(5, 150, 105, 0.1) !important; }
</style>

<%- include('partials/footer') %>